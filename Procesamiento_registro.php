<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Registro</title>
<body>

<?php
/******************************************************************************
    *
    * Filename: Procesamiento_registro.php
    *
    * Propósito: Insertar Nuevo Usuarios En La Tabla "usuarios" De Nestra Base De Datos Llamada (data_base).
    *
    * Language: PHP 5.6.35.
    *
    * Interprete: Apache 2.4.2 (WampServer Version 3.1.3).
    *
    * Autor:  Mario Alfonso Peña Viera.
    *
    * Date:03.03.2019.     
    *

    //=====================Programa Principal==================================

    //=========================================================================

******************************************************************************/
error_reporting(E_ALL);
ini_set('display_errors','1');

require("conex.php");
$idcone= conexion();

//Recibimos datos enviados desde el formulario.

$username=$_POST['username'];
$email=$_POST['email'];
$date=$_POST['date'];
$password=$_POST['password'];
$disconnected = 0;

//  //Obtiene la IP del cliente
// function get_client_ip() {
//   $ipaddress = '';
//   if (getenv('HTTP_CLIENT_IP'))
//       $ipaddress = getenv('HTTP_CLIENT_IP');

//   else if(getenv('HTTP_X_FORWARDED_FOR'))
//       $ipaddress = getenv('HTTP_X_FORWARDED_FOR');

//   else if(getenv('HTTP_X_FORWARDED'))
//       $ipaddress = getenv('HTTP_X_FORWARDED');

//   else if(getenv('HTTP_FORWARDED_FOR'))
//       $ipaddress = getenv('HTTP_FORWARDED_FOR');

//   else if(getenv('HTTP_FORWARDED'))
//      $ipaddress = getenv('HTTP_FORWARDED');

//   else if(getenv('REMOTE_ADDR'))
//       $ipaddress = getenv('REMOTE_ADDR');
//   else
//       $ipaddress = 'UNKNOWN';
//   if (strpos($ipaddress, ",") !== false) :
//     $ipaddress = strtok($ipaddress, ",");
//   endif;
//   return $ipaddress;
// }

//  //Obtiene la IP External
// function get_public_ip(){

//   $externalContent = file_get_contents('http://checkip.dyndns.com/');
//   preg_match('/Current IP Address: \[?([:.0-9a-fA-F]+)\]?/', $externalContent, $m);
//   $externalIp = $m[1];
//   return $externalIp;

// }

// // $theIP = get_client_ip();
// $theExternalIP = get_public_ip();

//  // echo 'Detected (Local) External IP : '.$theIP.PHP_EOL."<br>";
//  echo 'Detected Client IP : '.$theExternalIP.PHP_EOL."<br>";
//  echo  $_SERVER ['REMOTE_ADDR'] ;

//Obtiene la IP wam real
function get_IP_wam() {
    if (!empty($_SERVER['HTTP_CLIENT_IP']))
        return $_SERVER['HTTP_CLIENT_IP'];
       
    if (!empty($_SERVER['HTTP_X_FORWARDED_FOR']))
        return $_SERVER['HTTP_X_FORWARDED_FOR'];
   
    return $_SERVER['REMOTE_ADDR'];
}

//Obtiene la IP del cliente
function get_IP_cliente(){

  $externalContent = file_get_contents('http://checkip.dyndns.com/');
  preg_match('/Current IP Address: \[?([:.0-9a-fA-F]+)\]?/', $externalContent, $m);
  $externalIp = $m[1];
  return $externalIp;

}

$IP_wam     = get_IP_wam();
$IP_cliente = get_Ip_cliente();

$sql="INSERT INTO usuarios (Username,Email,Date,Password,Online,IP_cliente,IP_wam) VALUES ('$username','$email','$date','$password','$disconnected','$IP_cliente','$IP_wam')";

  if(mysqli_query($idcone,$sql)){

        header("location:index.html");
        // echo "<h1> <i> <center> Registro exitoso!  </center> </i> </h1>";

  }else{
     
        echo "<h1> <i> <center> Verifique sus datos!  </center> </i> </h1>";

  }

  mysqli_close($idcone); 

?>
<!---->
<style type="text/css">

body{
  margin:0;
  /*background:#c8c8c8;color:#6a6f8c;*/
  color:#00DD00;
  background:#343a40;
  
  font:600 16px/18px 'Open Sans',sans-serif;
}
*,:after,:before{box-sizing:border-box}
.clearfix:after,.clearfix:before{content:'';display:table}
.clearfix:after{clear:both;display:block}
a{color:inherit;text-decoration:none}


h1{

  position: relative;
  top: 200px;
}
</style>

</body>
</html>
